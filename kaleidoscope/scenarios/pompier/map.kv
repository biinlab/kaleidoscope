#:kivy 1.0.8


<ScenarioSelectorButton>:
	pos:self.pos
	canvas:
		Color:
			rgb: (1,1,1)
		BorderImage:
			pos:self.pos
			size: self.size
			source: self.source	

<ScenarioSelector>:		
	cols:2
	size_hint:(None,None)
	size:(512,163)
	center: self.center
	spacing:0
	padding:0
	x: 1500

<MapHandler>:
	cols:2
	size_hint:(None,None)
	size: (128,56)
	pos_hint:{'right':0.98,'y':0.03}
	auto_bring_to_front: True

<MapThumbnail>:
	do_scale: False
	do_rotation: False
	size_hint: (None, None)
	size: (80,80)	

	length_flag: (root.imagemap.center_y - self.center_y)

	# canvas:
	# 	Color:
	# 		rgb: self.color
	# 	BorderImage:
	# 		size: root.size
	# 		source: 'small_flag2.png'

	# canvas:
	# 	BorderImage:
	# 		source: root.media_picture
	# 		width: root.width * 0.25 if root.media_picture != '' else 0
	# 		x: root.width * 0.75 - 5

	Image:
		size_hint: (None,None)
		source: root.media_picture_thumbnail
		pos: 0,0
		size: 101,100
		canvas:
			Color:
				rgb: root.color
			Line:
				circle: self.width/2, self.height/2, self.width/2
				width: 3

	Label:
		text: root.current_country or ''
		font_size: 12
		# color: (0,0,0,1)
		y: root.height + 15
		x: 0
		valign: 'bottom'
		canvas.before:
			Color:
				rgba: (0,0,0,.5) if self.text != '' else (1,1,1,0)
				# rgba: root.color + [1] if self.text != '' else (1,1,1,0)
			Rectangle:
				source: 'data/etiquettes.png'
				size: 180, 60
				pos: self.width/2 - 90 , root.height + 30

	# Label:
	# 	text: root.title
	# 	font_name: 'Georgia_Italic.ttf'
	# 	font_size: 16
	# 	color: (.4, .4, .4, .7)
	# 	text_size: self.width - 20, self.height
	# 	size: root.width, 40
	# 	halign: 'left'
	# 	valign: 'bottom'
	# 	y: 10
	# 	x: 1

	# Label:
	# 	text: root.title
	# 	font_name: 'Georgia_Italic.ttf'
	# 	font_size: 16
	# 	color: (.05, .05, .05, 1)
	# 	text_size: self.width - 20, self.height
	# 	size: root.width, 40
	# 	halign: 'left'
	# 	valign: 'bottom'
	# 	y: 9

	# Label:
	# 	id: root.lbl
	# 	font_name: 'Georgia_Italic.ttf'
	# 	font_size: 16
	# 	color: (.3, .3, .3, .7)
	# 	text_size: self.width - 20, self.height - 20
	# 	size: root.width, 100
	# 	halign: 'left'
	# 	valign: 'bottom'
	# 	text: root.item.get('title')
	# 	x: 1

	# Label:
	# 	font_name: 'Georgia_Italic.ttf'
	# 	font_size: 16
	# 	color: (1, 1, 1, 1)
	# 	text_size: self.width - 20, self.height - 20
	# 	size: root.width, 100
	# 	halign: 'left'
	# 	valign: 'bottom'
	# 	text: root.item.get('title')

	
<MapEmptyPlace>:
	size_hint: (None, None)
	size: (130,60)
	canvas.before:
		Rectangle:
			size: self.size
			source: 'data/freeplace.png'
			# source: 'freeplace.png'
			pos: self.pos

<MapMenu>:
	launchGameButton: launchGameButton
	helpButton: helpButton
	canvas.before:
		Color:
			rgb: 1, 1, 1
		Rectangle:
			size: self.size
			pos: self.pos
			source: 'background.jpg'
	canvas:
		Color:
			rgba: (1,1,1,0.3)
		Line:
			circle: self.width/2, self.height/2, 210
			width: 10

		Color:
			rgba: root.color+[1] if root.time != 0 else (0,0,0,0)
		Line:
			circle: self.width/2, self.height/2, 210, 0, (180-root.time/15*180)
			cap: 'square'
			width: 11
	Button:
		id:launchGameButton
		size_hint: (None,None)
		# background_down: 'data/btn-jouer-active.png'
		# background_normal: 'data/btn-jouer.png'
		size: (180, 40)
		text: "jouer" 
		center_x: 1280/2
		center_y: 360

	Button:
		id:helpButton
		size_hint: (None,None)
		# background_down: 'data/btn-jouer-active.png'
		# background_normal: 'data/btn-jouer.png'
		size: (180, 40)
		text: "aide" 
		center_x: 1280/2
		center_y: 320
	
	Label:
		size_hint: None,None
		font_size: 120
		valign: 'top'
		text: str(int(root.time)) if root.time != 0 else ''
		center_x: 1280/2
		center_y: 450 
		# y: root.top - self.height - 10 - 300
		font_name: 'data/fonts/myra_regular.ttf'




<MapServerMenu>:
	canvas.before:
		Color:
			rgb: 1, 1, 1
		Rectangle:
			size: self.size
			pos: self.pos
			source: 'background.jpg'

	Label:
		size_hint: None,None
		font_size: 15

		valign: 'top'
		text: str(int(root.time)) if root.time != 0 else ''
		x: 50
		y: 50
		# y: root.top - self.height - 10 - 300
		font_name: 'data/fonts/DroidSans-Bold.ttf'

<MapClientLayout>:
	imagemap: imagemap
	exitButton: exitButton
	img_description: img_description
	content_description: content_description
	
	canvas.before:
		Color:
			rgb: 1, 1, 1
		Rectangle:
			size: self.size
			pos: self.pos
			source: 'background.jpg'
		#Color:
			#rgb: 0, 0, 0
		#Rectangle:
			#pos: root.right - 230 + 10, self.top - 10 - 64
			#size: 64, 64
			#source: root.logo + '_enable.png'

		# XXX dont duplicate image to make it darker >_<
		#Rectangle:
		#	pos: root.right - 230 + 10, self.top - 10 - 64
		#	size: 64, 64
		#	source: root.logo + '_enable.png'

	Button:
		id:exitButton
		size_hint: (None,None)
		background_down: 'data/btn-back-active.png'
		background_normal: 'data/btn-back.png'
		size: (224, 48)
		pos: 5, root.height - self.height

	Image:
		size_hint:(None,None)
		source: 'casque-bar.png'
		color: root.color + [1] or (1,1,1,1)
		pos: 100,50
		size: 980, 134

	Label:
		size_hint: (None, None)
		font_size: 16
		text_size: (214, 52)
		# height: 43
		y: 70
		x: 190
		color: (1, 1, 1, 1)
		text: 'place les casques sur la carte'
		font_name: 'data/fonts/myra_regular.ttf'

	Scatter:
		pos: 1280 -320, 0
		size_hint: None,None
		size: 320, 800
		do_scale: False
		do_rotation: False
		do_translation: False
		
		Image:
			size_hint: None,None
			pos: self.pos
			source:'data/panneau-droite-active.png'
			size: 320, 800

		Image:
			id: img_description
			size_hint: None,None
			source: 'casque_max.jpg'
			# source: '/Users/admin/Desktop/Travail/kaleidoscope/kaleidoscope/cache/pompier/data/sources/Europe_casque.png'
			pos: 10, 490
			size:300,300

		Label:
			id: content_description
			size_hint: None,None
			font_size: 15
			width: 300
			text_size: (300, 500)
			valign: 'top'
			font_name: 'data/fonts/DroidSans-Bold.ttf'
			# text: root.imagemap.current_content
			# text: 'Flumen praecipitem ad flumen coniunctos constrinxerunt acri constrinxerunt acri artuum ultimam iamque mox praecipitem eodem conpage corpora iamque velut in coniunctos velut artuum spatia divulsa ad ad scalas scalas eosque.'
			text: 'Flumen praecipitem ad flumen coniunctos constrinxerunt acri constrinxerunt acri artuum ultimam iamque'
			x: 10
			y: 150
			# y: root.top - self.height - 10 - 300
			font_name: 'data/fonts/DroidSans-Bold.ttf'

	Label:
		size_hint: (None, None)
		font_size: 43
		height: 43
		y: root.top - 10 - 32 - 22
		x: root.right - 230 + 90 - 300
		color: (.05, .05, .05, .6)
		text: str(int(root.time)) + '"'
		font_name: 'data/fonts/DroidSans-Bold.ttf'

	Label:
		size_hint: (None, None)
		font_size: 43
		height: 43
		y: root.top - 10 - 32 - 22
		x: root.right - 230 + 90 -300
		color: root.color + [1]
		text: str(int(root.time)) + '"'
		font_name: 'data/fonts/DroidSans-Bold.ttf'

		canvas.before:
			StencilPush
			Rectangle:
				pos: self.pos
				size: self.width, self.height * (1 - (root.time / float(root.timelimit)))
			StencilUse

		canvas.after:
			StencilPop

	Map:
		id: imagemap
		

<MapDescription>:
	layout: layout

	Image:
		size_hint: (None,None)
		source: 'panneau-droite-active.png'
		pos: 0,0
		size: 320, 800


<MapServerLayout>:

	canvas.before:
		Color:
			rgb: 1, 1, 1
		Rectangle:
			size: self.size
			pos: self.pos
			source: 'background.jpg'

<MapAudio>:
	AnchorLayout:
		pos: root.x, root.y + 50
		size_hint: (None, None)
		size: root.width, root.height - 50
		Button:
			size_hint: (None, None)
			size: (200, 100)
			text: 'Lire le fichier audio'
			on_release: root.play_audio()
